<!DOCTYPE html>
<html lang="ru-ru" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Этапы сборки
  #


Будем разбирать, как код на C превращается в ошику компиляции исполняемый файлик.

  Вот они слева направо
  #

(Ну только сверху вниз)




  





graph TD;
    c[Код на C]
    yac[Снова код на C]
    asm[Код на ассемблере]
    op[Машинные инструкции]
    elf[Исполняемый файл]

    c --&gt;|Препроцессор| yac
    yac --&gt;|Компилятор| asm
    asm --&gt;|Ассемблер| op
    op --&gt;|Линкер| elf


(и да, препроцессор из кода на C делает код на C)">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://example.org/docs/theory/devools/build/">
  <meta property="og:site_name" content="caos theory">
  <meta property="og:title" content="этапы сборки">
  <meta property="og:description" content=" Этапы сборки # Будем разбирать, как код на C превращается в ошику компиляции исполняемый файлик.
Вот они слева направо # (Ну только сверху вниз) graph TD; c[Код на C] yac[Снова код на C] asm[Код на ассемблере] op[Машинные инструкции] elf[Исполняемый файл] c --&gt;|Препроцессор| yac yac --&gt;|Компилятор| asm asm --&gt;|Ассемблер| op op --&gt;|Линкер| elf (и да, препроцессор из кода на C делает код на C)">
  <meta property="og:locale" content="ru_ru">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
<title>этапы сборки | caos theory</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://example.org/docs/theory/devools/build/">
<link rel="stylesheet" href="/book.min.3b63b9ecb24b01f1be0df5c6f361b3a2004ab96665227385e0196f67e7607b29.css" integrity="sha256-O2O57LJLAfG&#43;DfXG82GzogBKuWZlInOF4BlvZ&#43;dgeyk=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.93d52fc8b10a24f3802098b98f62975ff2c140cd8aa0310c08e65da210a90f41.js" integrity="sha256-k9UvyLEKJPOAIJi5j2KXX/LBQM2KoDEMCOZdohCpD0E=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>caos theory</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <a href="/docs/theory/" class="">Как закрыть курс</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/theory/whoami/" class="">whoami</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/theory/necronomicon/" class="">Некрономикон</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-96321df072730b9a64870c0191c9133b" class="toggle" checked />
    <label for="section-96321df072730b9a64870c0191c9133b" class="flex justify-between">
      <a href="/docs/theory/devools/" class="">Инструменты разработки</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/theory/devools/bash/" class="">bash</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/theory/devools/build/" class="active">этапы сборки</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/theory/devools/debugger/" class="">как ловить ошибки</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/theory/devools/make/" class="">автоматизация сборки</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-123d53d4dd188d20ee5174bebd51adc4" class="toggle"  />
    <label for="section-123d53d4dd188d20ee5174bebd51adc4" class="flex justify-between">
      <a href="/docs/theory/x86_64/" class="">x86_64 assembler</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/theory/x86_64/floats/" class="">floats</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2ac106c088cac53c4787d657cccdb647" class="toggle"  />
    <label for="section-2ac106c088cac53c4787d657cccdb647" class="flex justify-between">
      <a href="/docs/theory/arm/" class="">ARM assembler</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/theory/arm/linaro/" class="">Linaro (а как тестить)</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>этапы сборки</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#вот-они-слева-направо">Вот они слева направо</a></li>
    <li><a href="#препроцессор">Препроцессор</a>
      <ul>
        <li><a href="#что-с-его-помощью-можно-делать">Что с его помощью можно делать</a></li>
        <li><a href="#мотивация">Мотивация</a></li>
      </ul>
    </li>
    <li><a href="#компилятор">Компилятор</a></li>
    <li><a href="#ассемблер">Ассемблер</a></li>
    <li><a href="#линкер">Линкер</a>
      <ul>
        <li><a href="#чем-ещё-занимается-линкер">Чем ещё занимается линкер</a></li>
      </ul>
    </li>
    <li><a href="#а-ещё-я-вам-все-это-время-врал">А ещё я вам все это время врал</a></li>
    <li><a href="#elf-файл">ELF файл</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="этапы-сборки">
  Этапы сборки
  <a class="anchor" href="#%d1%8d%d1%82%d0%b0%d0%bf%d1%8b-%d1%81%d0%b1%d0%be%d1%80%d0%ba%d0%b8">#</a>
</h1>
<p><img src="/sems/devtools/vjuh.jpg" alt="вжух!" /></p>
<p>Будем разбирать, как код на C превращается в <del>ошику компиляции</del> исполняемый файлик.</p>
<h2 id="вот-они-слева-направо">
  Вот они слева направо
  <a class="anchor" href="#%d0%b2%d0%be%d1%82-%d0%be%d0%bd%d0%b8-%d1%81%d0%bb%d0%b5%d0%b2%d0%b0-%d0%bd%d0%b0%d0%bf%d1%80%d0%b0%d0%b2%d0%be">#</a>
</h2>
<p>(Ну только сверху вниз)


<script src="/mermaid.min.js"></script>

  <script>mermaid.initialize({
  "flowchart": {
    "useMaxWidth":true
  },
  "theme": "default"
}
)</script>




<pre class="mermaid">
graph TD;
    c[Код на C]
    yac[Снова код на C]
    asm[Код на ассемблере]
    op[Машинные инструкции]
    elf[Исполняемый файл]

    c -->|Препроцессор| yac
    yac -->|Компилятор| asm
    asm -->|Ассемблер| op
    op -->|Линкер| elf
</pre>
</p>
<p>(и да, препроцессор из кода на C делает код на C)</p>
<p>Почти во всех домашках вы будете просто запускать компилятор <code>gcc</code>, после чего вы получите файл <code>a.out</code>, который уже является исполняемым.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcc main.c
</span></span></code></pre></div><p>Сейчас давайте пройдемся явно шаг за шагом на примере простой программы</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">greet</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>name) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Hello, %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, name);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* argc - кол-во аргументов, переданых программе при запуске
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * argv - массив строк из этих аргументов
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Хотим чего-то вида
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * ```
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * $ ./a.out CAOS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Hello, CAOS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * ```
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Тогда должно быть ДВА аргумента (argc == 2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * argv[0] - имя программы
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * argv[1] - имя, которое надо поприветствовать
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// при неправильном кол-ве аргументов
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// подсказываем, как правильно пользоваться
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Usage:</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">%s name</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, argv[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">greet</span>(argv[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Для начала просто соберём. Через флаг <code>-o</code> можно передать имя выходного файла. <code>a.out</code> - имя по умолчанию</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcc main.c -o a.out
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ./a.out
</span></span><span style="display:flex;"><span>Usage:
</span></span><span style="display:flex;"><span>    ./a.out name
</span></span><span style="display:flex;"><span>$ ./a.out hello world
</span></span><span style="display:flex;"><span>Usage:
</span></span><span style="display:flex;"><span>    ./a.out name
</span></span><span style="display:flex;"><span>$ ./a.out danila
</span></span><span style="display:flex;"><span>Hello, danila
</span></span></code></pre></div><h2 id="препроцессор">
  Препроцессор
  <a class="anchor" href="#%d0%bf%d1%80%d0%b5%d0%bf%d1%80%d0%be%d1%86%d0%b5%d1%81%d1%81%d0%be%d1%80">#</a>
</h2>
<p>Препроцессор - это текстовый процессор (программа для обработки текста).
Ну и он может делать только простые текстовые операции - подставить один кусок текста вместо вдругого или удалить кусок текста.</p>
<h3 id="что-с-его-помощью-можно-делать">
  Что с его помощью можно делать
  <a class="anchor" href="#%d1%87%d1%82%d0%be-%d1%81-%d0%b5%d0%b3%d0%be-%d0%bf%d0%be%d0%bc%d0%be%d1%89%d1%8c%d1%8e-%d0%bc%d0%be%d0%b6%d0%bd%d0%be-%d0%b4%d0%b5%d0%bb%d0%b0%d1%82%d1%8c">#</a>
</h3>
<p>В C (да и в C++) команды препроцессора начинаются с символа <code>#</code>. Некоторые из них:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;foo.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#line 42 &#34;somefile.h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define PI 3.1415926
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define MAX(a, b) (((a) &gt;= (b)) ? (a) : (b))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define FOO_H
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#if 2 == 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ifdef FOO_H
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ifndef FOO_H
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#elif BAR_H
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span></code></pre></div><p>Каждая из этих команд <strong>только</strong> обрабатывает текст</p>
<ul>
<li><code>#include</code> - подставляет вместо себя содержимое файла
<ul>
<li>если скобки <code>&lt;треугольные&gt;</code>, то поиск файла происходит в стандартных путях (всем у кого видна - соболезную); например в <code>/usr/include/</code>; дополнительные пути можно передать, вызвав <code>gcc</code> с флагом <code>-I</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcc main.c -I/path/to/include/dir/ ...
</span></span></code></pre></div><ul>
<li>если используются <code>&quot;кавычки&quot;</code>, то поиск файла <strong>в начале</strong> идет в директории, где лежит файл, <strong>а потом</strong> в стандартных путях</li>
</ul>
</li>
<li><code>#line</code> похож на <code>#include</code>, но он подставляет не весь файл, а конкретную строку</li>
<li><code>#define</code> - определяет макросы; так можно задавать константы и правила подстановки
<ul>
<li>вместо <code>PI</code> (пример выше) во время сборки будет подставлено значение <code>3.1415926</code></li>
<li>правило <code>MAX(a, b)</code> будет раскрыто напрямую, <a href="/docs/theory/necronomicon/#%d0%bc%d0%b0%d0%ba%d1%80%d0%be%d1%81%d1%8b">а это плохо</a></li>
<li>ещё <code>#define</code> может объявлять пустые константы; например <code>#define FOO_H</code> объявит пустую
константу <code>FOO_H</code> (пример, зачем такое нужно - ниже)</li>
</ul>
</li>
<li><code>#if...</code> - с их помощью можно выкидывать куски кода из файла; например <code>#if __linux__</code> будет верно, только при сборке на linux-дистрибутивах</li>
</ul>
<blockquote class="book-hint info">
<blockquote>
<p>а откуда берутся эти константы?
ну там <code>__linux__</code> и прочие?</p>
</blockquote>
<p>Такие константы идут предопределенными вместе с компилятором
(в месте с компилятором идет стандартная библиотека и т.д.)</p>
</blockquote>
<ul>
<li><code>#ifdef ABC</code> - проверяет, определена ли константа <code>ABC</code> (<code>#ifndef</code> - проверяет, если константа НЕ определена)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#ifdef ABC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// этот код подставляется если ABC определена
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// этот код подставляется если ABC НЕ определена
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#endif  </span><span style="color:#75715e">// ABC
</span></span></span></code></pre></div><p>Можно запустить только препроцессор, вызвав <code>gcc</code> с флагом <code>-E</code>
(файлик получится большой, поэтому посмотрим только на последние 20 строчек)</p>
<details ><summary>main.c</summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">greet</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>name) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Hello, %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, name);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* argc - кол-во аргументов, переданых программе при запуске
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * argv - массив строк из этих аргументов
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Хотим чего-то вида
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * ```
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * $ ./a.out CAOS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Hello, CAOS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * ```
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Тогда должно быть ДВА аргумента (argc == 2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * argv[0] - имя программы
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * argv[1] - имя, которое надо поприветствовать
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// при неправильном кол-ве аргументов
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// подсказываем, как правильно пользоваться
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Usage:</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">%s name</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, argv[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">greet</span>(argv[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>  </div>
</details>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ gcc -E main.c -o main.i
</span></span><span style="display:flex;"><span>$ tail -20 main.i
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2 &#34;main.c&#34; 2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3 &#34;main.c&#34;</span>
</span></span><span style="display:flex;"><span>void greet<span style="color:#f92672">(</span>char *name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello, %s\n&#34;</span>, name<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>int main<span style="color:#f92672">(</span>int argc, char **argv<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 22 &#34;main.c&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>argc !<span style="color:#f92672">=</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Usage:\n\t%s name\n&#34;</span>, argv<span style="color:#f92672">[</span>0<span style="color:#f92672">])</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> 1;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    greet<span style="color:#f92672">(</span>argv<span style="color:#f92672">[</span>1<span style="color:#f92672">])</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> 0;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Там сохранился код на C, и рекурсивно подставилось содержимое инклудов (<code>stdio.h</code>).
Код на C - это наша программа, а странные строки вида <code># 22 &quot;main.c&quot;</code> - отладочная инфа.
Когда вы ловите ошибку компиляции - благодаря этим комментариям компилятор показывает вам,
где и менно и что именно упало.</p>
<p>С точки зрения самого языка C, строки, начинающиеся с <code># </code> - это комментарии</p>
<h3 id="мотивация">
  Мотивация
  <a class="anchor" href="#%d0%bc%d0%be%d1%82%d0%b8%d0%b2%d0%b0%d1%86%d0%b8%d1%8f">#</a>
</h3>
<blockquote>
<p>А зачем вообще я могу хотеть удалять куски кода? Я же их так старательно&hellip;</p>
</blockquote>
<p>Ну вот пример - есть библиотека <code>small_math.h</code> - в ней вы сами написали свои мат. функции специально
для работы с малыми величинами.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">// small_math.h
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// вычисляет произвудную синуса в точке x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// при малых значениях x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">double</span> <span style="color:#a6e22e">small_sin_deriv</span>(<span style="color:#66d9ef">double</span> x) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1.0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>и вы этот файлик используете в нескольких своих модулях - <code>elliptic_curves.h</code> и <code>my_hash.h</code></p>
<details ><summary>elliptic_curves.h</summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;small_math.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ну и тут что-нибудь важное
</span></span></span></code></pre></div>  </div>
</details>
<details ><summary>my_hash.h</summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;small_math.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ну и тут что-нибудь необходимое
</span></span></span></code></pre></div>  </div>
</details>
<p>А потом оба этих файлика вы используете в <code>main.c</code></p>
<details ><summary>main.c</summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;elliptic_curves.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;my_hash.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... //
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div>  </div>
</details>
<p>Попробуем собрать и получим&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ gcc main.c
</span></span><span style="display:flex;"><span>In file included from my_hash.h:1,
</span></span><span style="display:flex;"><span>                 from main.c:2:
</span></span><span style="display:flex;"><span>small_math.h:3:8: error: redefinition of ‘small_sin_deriv’
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">3</span> | double small_sin_deriv<span style="color:#f92672">(</span>double x<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      |        ^~~~~~~~~~~~~~~
</span></span><span style="display:flex;"><span>In file included from elliptic_curves.h:1,
</span></span><span style="display:flex;"><span>                 from main.c:1:
</span></span><span style="display:flex;"><span>small_math.h:3:8: note: previous definition of ‘small_sin_deriv’ with type ‘double<span style="color:#f92672">(</span>double<span style="color:#f92672">)</span>’
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">3</span> | double small_sin_deriv<span style="color:#f92672">(</span>double x<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      |        ^~~~~~~~~~~~~~~
</span></span></code></pre></div><p>ошибку <code>redefinition of ‘small_sin_deriv’</code>.</p>
<p>ЧТо зА фиГня?! - спросите вы</p>
<p>Перечитайте, как работает <code>#include</code> - отвечу вам я.</p>
<p>Запустим с флагом <code>-E</code> и посмотрим
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="background-color:#3c3d38"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></span><span style="background-color:#3c3d38"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></span><span style="background-color:#3c3d38"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="background-color:#3c3d38"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></span><span style="background-color:#3c3d38"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></span><span style="background-color:#3c3d38"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ gcc -E main.c
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0 &#34;main.c&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0 &#34;&lt;built-in&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0 &#34;&lt;command-line&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1 &#34;/usr/include/stdc-predef.h&#34; 1 3 4</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0 &#34;&lt;command-line&gt;&#34; 2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1 &#34;main.c&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1 &#34;elliptic_curves.h&#34; 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1 &#34;small_math.h&#34; 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>double small_sin_deriv<span style="color:#f92672">(</span>double x<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#66d9ef">return</span> 1.0;
</span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2 &#34;elliptic_curves.h&#34; 2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2 &#34;main.c&#34; 2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1 &#34;my_hash.h&#34; 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1 &#34;small_math.h&#34; 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>double small_sin_deriv<span style="color:#f92672">(</span>double x<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#66d9ef">return</span> 1.0;
</span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2 &#34;my_hash.h&#34; 2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3 &#34;main.c&#34; 2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>int main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></td></tr></table>
</div>
</div></p>
<p>Как видите функций правда две - одна пришла из <code>elliptic_curves.h</code>, вторая - из <code>my_hash.h</code>.
В ошибке ровно это и описано.</p>
<p>Эту проблему можно решить при помощи макросов - нужно инклудить <code>small_math.h</code> только один раз.
В <code>C++</code> вместо большой конструкции можно просто написать <code>#pragma once</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">// small_math.h
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#ifndef SMALL_MATH_H
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define SMALL_MATH_H
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// вычисляет произвудную синуса в точке x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// при малых значениях x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">double</span> <span style="color:#a6e22e">small_sin_deriv</span>(<span style="color:#66d9ef">double</span> x) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1.0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#endif  </span><span style="color:#75715e">// SMALL_MATH_H
</span></span></span></code></pre></div><p>Принято азывать константы таким образом <code>SMALL_MATH_H</code> - капсом и заменяя точку на <code>_</code>.
Старайтесь делать так же))</p>
<p>Теперь файл будет &ldquo;скопирован&rdquo; только один раз во время сборки</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ gcc -E main.c
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0 &#34;main.c&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0 &#34;&lt;built-in&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0 &#34;&lt;command-line&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1 &#34;/usr/include/stdc-predef.h&#34; 1 3 4</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0 &#34;&lt;command-line&gt;&#34; 2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1 &#34;main.c&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1 &#34;elliptic_curves.h&#34; 1   &lt;-- вот в этом файле подключается small_math.h</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1 &#34;small_math.h&#34; 1        &lt;-- вот прям вот тут вот</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ТУТ МНОГО ПУСТОГО МЕСТА ИЗ-ЗА КОММЕНТАРИЕВ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>double small_sin_deriv<span style="color:#f92672">(</span>double x<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> 1.0;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2 &#34;elliptic_curves.h&#34; 2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2 &#34;main.c&#34; 2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1 &#34;my_hash.h&#34; 1           &lt;-- а вот тут small_math.h уже не подключается</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3 &#34;main.c&#34; 2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>int main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>И сама сборка пройдет без ошибок</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ gcc main.c
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>ошибки нет<span style="color:#f92672">)</span>
</span></span></code></pre></div><h2 id="компилятор">
  Компилятор
  <a class="anchor" href="#%d0%ba%d0%be%d0%bc%d0%bf%d0%b8%d0%bb%d1%8f%d1%82%d0%be%d1%80">#</a>
</h2>
<p>У нас есть код на C&hellip; снова!) Компилятор из кода на си делает код на языке ассемблера.</p>
<p>Посмотрим, что станет с нашим файлом. Запустим с флагом <code>-S</code> (можно передавать <code>main.c</code>, так и <code>main.i</code>). Аргумент <code>-masm=intel</code> укажет на Intel-синтаксис языка ассемблера (<code>TODO: вставить ссылку</code>)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcc -S -masm<span style="color:#f92672">=</span>intel main.c
</span></span></code></pre></div><details ><summary>main.c</summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">greet</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>name) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Hello, %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, name);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* argc - кол-во аргументов, переданых программе при запуске
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * argv - массив строк из этих аргументов
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Хотим чего-то вида
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * ```
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * $ ./a.out CAOS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Hello, CAOS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * ```
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Тогда должно быть ДВА аргумента (argc == 2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * argv[0] - имя программы
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * argv[1] - имя, которое надо поприветствовать
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// при неправильном кол-ве аргументов
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// подсказываем, как правильно пользоваться
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Usage:</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">%s name</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, argv[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">greet</span>(argv[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>  </div>
</details>
<details ><summary>main.s</summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>	<span style="color:#a6e22e">.file</span>	<span style="color:#e6db74">&#34;main.c&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.intel_syntax</span> <span style="color:#66d9ef">noprefix</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.text</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.section</span>	<span style="color:#66d9ef">.rodata</span>
</span></span><span style="display:flex;"><span>.LC0:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.string</span>	<span style="color:#e6db74">&#34;Hello, %s\n&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.text</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.globl</span>	<span style="color:#66d9ef">greet</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.type</span>	<span style="color:#66d9ef">greet</span>, <span style="color:#a6e22e">@function</span>
</span></span><span style="display:flex;"><span>greet:
</span></span><span style="display:flex;"><span>.LFB0:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_startproc</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">push</span>	<span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_def_cfa_offset</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_offset</span> <span style="color:#ae81ff">6</span>, -<span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_def_cfa_register</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sub</span>	<span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">8</span>[<span style="color:#66d9ef">rbp</span>], <span style="color:#66d9ef">rdi</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">8</span>[<span style="color:#66d9ef">rbp</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">lea</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">.LC0</span>[<span style="color:#66d9ef">rip</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">call</span>	<span style="color:#66d9ef">printf@PLT</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">nop</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">leave</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_def_cfa</span> <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ret</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_endproc</span>
</span></span><span style="display:flex;"><span>.LFE0:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.size</span>	<span style="color:#66d9ef">greet</span>, <span style="color:#66d9ef">.-greet</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.section</span>	<span style="color:#66d9ef">.rodata</span>
</span></span><span style="display:flex;"><span>.LC1:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.string</span>	<span style="color:#e6db74">&#34;Usage:\n\t%s name\n&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.text</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.globl</span>	<span style="color:#66d9ef">main</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.type</span>	<span style="color:#66d9ef">main</span>, <span style="color:#a6e22e">@function</span>
</span></span><span style="display:flex;"><span>main:
</span></span><span style="display:flex;"><span>.LFB1:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_startproc</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">push</span>	<span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_def_cfa_offset</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_offset</span> <span style="color:#ae81ff">6</span>, -<span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_def_cfa_register</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sub</span>	<span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">DWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">4</span>[<span style="color:#66d9ef">rbp</span>], <span style="color:#66d9ef">edi</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">16</span>[<span style="color:#66d9ef">rbp</span>], <span style="color:#66d9ef">rsi</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cmp</span>	<span style="color:#66d9ef">DWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">4</span>[<span style="color:#66d9ef">rbp</span>], <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">je</span>	<span style="color:#66d9ef">.L3</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">16</span>[<span style="color:#66d9ef">rbp</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> [<span style="color:#66d9ef">rax</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">lea</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">.LC1</span>[<span style="color:#66d9ef">rip</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">call</span>	<span style="color:#66d9ef">printf@PLT</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">jmp</span>	<span style="color:#66d9ef">.L4</span>
</span></span><span style="display:flex;"><span>.L3:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">16</span>[<span style="color:#66d9ef">rbp</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">add</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> [<span style="color:#66d9ef">rax</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">call</span>	<span style="color:#66d9ef">greet</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>.L4:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">leave</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_def_cfa</span> <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ret</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_endproc</span>
</span></span><span style="display:flex;"><span>.LFE1:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.size</span>	<span style="color:#66d9ef">main</span>, <span style="color:#66d9ef">.-main</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.ident</span>	<span style="color:#e6db74">&#34;GCC: (GNU) 14.2.1 20240910&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.section</span>	<span style="color:#66d9ef">.note.GNU-stack</span>,<span style="color:#e6db74">&#34;&#34;</span>,<span style="color:#a6e22e">@progbits</span>
</span></span></code></pre></div>  </div>
</details>
<p>Язык ассемблера подробно будет разобран вот тут (<code>TODO: вставить ссылку</code>).
Но сейчас угадываются разные куски программы</p>
<details ><summary>функция greet</summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>greet:
</span></span><span style="display:flex;"><span>.LFB0:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_startproc</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">push</span>	<span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_def_cfa_offset</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_offset</span> <span style="color:#ae81ff">6</span>, -<span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_def_cfa_register</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sub</span>	<span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">8</span>[<span style="color:#66d9ef">rbp</span>], <span style="color:#66d9ef">rdi</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">8</span>[<span style="color:#66d9ef">rbp</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">lea</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">.LC0</span>[<span style="color:#66d9ef">rip</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">call</span>	<span style="color:#66d9ef">printf@PLT</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">nop</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">leave</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_def_cfa</span> <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ret</span>
</span></span></code></pre></div>  </div>
</details>
<details ><summary>строка Usage</summary>
  <div class="markdown-inner">
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="background-color:#3c3d38"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>.LFE0:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.size</span>	<span style="color:#66d9ef">greet</span>, <span style="color:#66d9ef">.-greet</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.section</span>	<span style="color:#66d9ef">.rodata</span>
</span></span><span style="display:flex;"><span>.LC1:
</span></span><span style="display:flex; background-color:#3c3d38"><span>	<span style="color:#a6e22e">.string</span>	<span style="color:#e6db74">&#34;Usage:\n\t%s name\n&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.text</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.globl</span>	<span style="color:#66d9ef">main</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.type</span>	<span style="color:#66d9ef">main</span>, <span style="color:#a6e22e">@function</span></span></span></code></pre></td></tr></table>
</div>
</div>
  </div>
</details>
<details ><summary>функция main</summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>main:
</span></span><span style="display:flex;"><span>.LFB1:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_startproc</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">push</span>	<span style="color:#66d9ef">rbp</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_def_cfa_offset</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_offset</span> <span style="color:#ae81ff">6</span>, -<span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rbp</span>, <span style="color:#66d9ef">rsp</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_def_cfa_register</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sub</span>	<span style="color:#66d9ef">rsp</span>, <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">DWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">4</span>[<span style="color:#66d9ef">rbp</span>], <span style="color:#66d9ef">edi</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">16</span>[<span style="color:#66d9ef">rbp</span>], <span style="color:#66d9ef">rsi</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cmp</span>	<span style="color:#66d9ef">DWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">4</span>[<span style="color:#66d9ef">rbp</span>], <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">je</span>	<span style="color:#66d9ef">.L3</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">16</span>[<span style="color:#66d9ef">rbp</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> [<span style="color:#66d9ef">rax</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">lea</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">.LC1</span>[<span style="color:#66d9ef">rip</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">call</span>	<span style="color:#66d9ef">printf@PLT</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">jmp</span>	<span style="color:#66d9ef">.L4</span>
</span></span><span style="display:flex;"><span>.L3:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> -<span style="color:#ae81ff">16</span>[<span style="color:#66d9ef">rbp</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">add</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">QWORD</span> <span style="color:#66d9ef">PTR</span> [<span style="color:#66d9ef">rax</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">call</span>	<span style="color:#66d9ef">greet</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">mov</span>	<span style="color:#66d9ef">eax</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>.L4:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">leave</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">.cfi_def_cfa</span> <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ret</span>
</span></span></code></pre></div>  </div>
</details>
<h2 id="ассемблер">
  Ассемблер
  <a class="anchor" href="#%d0%b0%d1%81%d1%81%d0%b5%d0%bc%d0%b1%d0%bb%d0%b5%d1%80">#</a>
</h2>
<p>С ассемблером небольшая путаница&hellip;</p>
<ul>
<li><strong>ассемблер</strong> - это программа</li>
<li><strong>язык ассемблера</strong> - это язык</li>
</ul>
<p><strong>Ассемблер</strong> переводит код на <strong>языке ассемблера</strong> в машинные инструкции (op-коды).
Теперь пожалуйста не путайте)</p>
<p>Продолжим издеваться над программой. Запустим компилятор с флагом <code>-c</code>, чтоб на выходе получить
объектный файл - тот самый файл с машинными инструкциями - <code>main.o</code></p>
<details ><summary>main.c</summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">greet</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>name) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Hello, %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, name);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* argc - кол-во аргументов, переданых программе при запуске
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * argv - массив строк из этих аргументов
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Хотим чего-то вида
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * ```
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * $ ./a.out CAOS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Hello, CAOS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * ```
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Тогда должно быть ДВА аргумента (argc == 2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * argv[0] - имя программы
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * argv[1] - имя, которое надо поприветствовать
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// при неправильном кол-ве аргументов
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// подсказываем, как правильно пользоваться
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Usage:</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">%s name</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, argv[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">greet</span>(argv[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>  </div>
</details>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ gcc -c main.c
</span></span><span style="display:flex;"><span>$ file main.o
</span></span><span style="display:flex;"><span>main.o: ELF 64-bit LSB relocatable, x86-64, version <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>SYSV<span style="color:#f92672">)</span>, not stripped
</span></span></code></pre></div><p>Команда <code>file</code> читает заголовок файла и печатает информацию о нём. <code>ELF</code> - <code>Executable and Linkable File</code> - формат исполняемых файлов на Unix-системах.</p>
<p>Можем декомпилировать объектный файл - напечатать машинные инструкции в виде мнемоник
на языке ассемблера.</p>
<details ><summary>декомпилированный код</summary>
  <div class="markdown-inner">
<p>Кодс условно разбит на 3 колонки</p>
<ul>
<li>в первой колонке указано смещение относительно начала op-кодов</li>
<li>во второй колонке идут те самые op-коды</li>
<li>в третьей колонке - декомпилированный код на языке ассемблера (да, снова)</li>
</ul>
<p>Даже не зная язык ассемблера, можно угадать функции <code>greet</code> и <code>main</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ objdump -d -M intel main.o
</span></span><span style="display:flex;"><span>main.o:     file format elf64-x86-64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Disassembly of section .text:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0000000000000000</span> &lt;greet&gt;:
</span></span><span style="display:flex;"><span>   0:	<span style="color:#ae81ff">55</span>                   	push   rbp
</span></span><span style="display:flex;"><span>   1:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> e5             	mov    rbp,rsp
</span></span><span style="display:flex;"><span>   4:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">10</span>          	sub    rsp,0x10
</span></span><span style="display:flex;"><span>   8:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> 7d f8          	mov    QWORD PTR <span style="color:#f92672">[</span>rbp-0x8<span style="color:#f92672">]</span>,rdi
</span></span><span style="display:flex;"><span>   c:	<span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">45</span> f8          	mov    rax,QWORD PTR <span style="color:#f92672">[</span>rbp-0x8<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  10:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> c6             	mov    rsi,rax
</span></span><span style="display:flex;"><span>  13:	<span style="color:#ae81ff">48</span> 8d <span style="color:#ae81ff">05</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	lea    rax,<span style="color:#f92672">[</span>rip+0x0<span style="color:#f92672">]</span>        <span style="color:#75715e"># 1a &lt;greet+0x1a&gt;</span>
</span></span><span style="display:flex;"><span>  1a:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> c7             	mov    rdi,rax
</span></span><span style="display:flex;"><span>  1d:	b8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       	mov    eax,0x0
</span></span><span style="display:flex;"><span>  22:	e8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       	call   <span style="color:#ae81ff">27</span> &lt;greet+0x27&gt;
</span></span><span style="display:flex;"><span>  27:	<span style="color:#ae81ff">90</span>                   	nop
</span></span><span style="display:flex;"><span>  28:	c9                   	leave
</span></span><span style="display:flex;"><span>  29:	c3                   	ret
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>000000000000002a &lt;main&gt;:
</span></span><span style="display:flex;"><span>  2a:	<span style="color:#ae81ff">55</span>                   	push   rbp
</span></span><span style="display:flex;"><span>  2b:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> e5             	mov    rbp,rsp
</span></span><span style="display:flex;"><span>  2e:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">10</span>          	sub    rsp,0x10
</span></span><span style="display:flex;"><span>  32:	<span style="color:#ae81ff">89</span> 7d fc             	mov    DWORD PTR <span style="color:#f92672">[</span>rbp-0x4<span style="color:#f92672">]</span>,edi
</span></span><span style="display:flex;"><span>  35:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> <span style="color:#ae81ff">75</span> f0          	mov    QWORD PTR <span style="color:#f92672">[</span>rbp-0x10<span style="color:#f92672">]</span>,rsi
</span></span><span style="display:flex;"><span>  39:	<span style="color:#ae81ff">83</span> 7d fc <span style="color:#ae81ff">02</span>          	cmp    DWORD PTR <span style="color:#f92672">[</span>rbp-0x4<span style="color:#f92672">]</span>,0x2
</span></span><span style="display:flex;"><span>  3d:	<span style="color:#ae81ff">74</span> <span style="color:#ae81ff">25</span>                	je     <span style="color:#ae81ff">64</span> &lt;main+0x3a&gt;
</span></span><span style="display:flex;"><span>  3f:	<span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">45</span> f0          	mov    rax,QWORD PTR <span style="color:#f92672">[</span>rbp-0x10<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  43:	<span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">00</span>             	mov    rax,QWORD PTR <span style="color:#f92672">[</span>rax<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  46:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> c6             	mov    rsi,rax
</span></span><span style="display:flex;"><span>  49:	<span style="color:#ae81ff">48</span> 8d <span style="color:#ae81ff">05</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	lea    rax,<span style="color:#f92672">[</span>rip+0x0<span style="color:#f92672">]</span>        <span style="color:#75715e"># 50 &lt;main+0x26&gt;</span>
</span></span><span style="display:flex;"><span>  50:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> c7             	mov    rdi,rax
</span></span><span style="display:flex;"><span>  53:	b8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       	mov    eax,0x0
</span></span><span style="display:flex;"><span>  58:	e8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       	call   5d &lt;main+0x33&gt;
</span></span><span style="display:flex;"><span>  5d:	b8 <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       	mov    eax,0x1
</span></span><span style="display:flex;"><span>  62:	eb <span style="color:#ae81ff">18</span>                	jmp    7c &lt;main+0x52&gt;
</span></span><span style="display:flex;"><span>  64:	<span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">45</span> f0          	mov    rax,QWORD PTR <span style="color:#f92672">[</span>rbp-0x10<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  68:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> c0 <span style="color:#ae81ff">08</span>          	add    rax,0x8
</span></span><span style="display:flex;"><span>  6c:	<span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">00</span>             	mov    rax,QWORD PTR <span style="color:#f92672">[</span>rax<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  6f:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> c7             	mov    rdi,rax
</span></span><span style="display:flex;"><span>  72:	e8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       	call   <span style="color:#ae81ff">77</span> &lt;main+0x4d&gt;
</span></span><span style="display:flex;"><span>  77:	b8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       	mov    eax,0x0
</span></span><span style="display:flex;"><span>  7c:	c9                   	leave
</span></span><span style="display:flex;"><span>  7d:	c3                   	ret
</span></span></code></pre></div>  </div>
</details>
<h2 id="линкер">
  Линкер
  <a class="anchor" href="#%d0%bb%d0%b8%d0%bd%d0%ba%d0%b5%d1%80">#</a>
</h2>
<p>До этого момента мы занимались сборкой файлов.
На вход подавался один файл - на выходе был другой файл (но тоже один!).
Но проекты состоят из многих файлов. Да, их можно передать на вход <code>gcc main.c lib1.c lib2.c ...</code>.
До текущего момента каждый из них собирался <strong>независимо</strong> - и на данном этапе мы имеем множество
<code>.o</code> файлов - <code>main.o</code>, <code>lib1.o</code>, <code>lib2.o</code> &hellip;</p>
<p>Линкер занимается тем, что собирает разные <code>.o</code> файли вместе. У каждого <code>.o</code> файла в заголовке
есть таблица символов. Пока можно считать, что это словарь (отображение)

<link rel="stylesheet" href="/katex/katex.min.css" />
<script defer src="/katex/katex.min.js"></script>
<script defer src="/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script><span>
  \[
ИМЯ\_ФУНКЦИИ \rightarrow ЕЁ\_АДРЕС
\]
</span>

(под &ldquo;адресом&rdquo; имеется в виду смещение относительно начала секции с op-кодами)</p>
<p>У нашего <code>main.o</code> тоже есть таблица символов</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ objdump -t main.o
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>main.o:     file format elf64-x86-64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SYMBOL TABLE:
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0000000000000000</span> l    df *ABS*	<span style="color:#ae81ff">0000000000000000</span> main.c
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0000000000000000</span> l    d  .text	<span style="color:#ae81ff">0000000000000000</span> .text
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0000000000000000</span> l    d  .rodata	<span style="color:#ae81ff">0000000000000000</span> .rodata
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0000000000000000</span> g     F .text	000000000000002a greet
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0000000000000000</span>         *UND*	<span style="color:#ae81ff">0000000000000000</span> printf
</span></span><span style="display:flex;"><span>000000000000002a g     F .text	<span style="color:#ae81ff">0000000000000054</span> main
</span></span></code></pre></div><p>Тут снова можно увидеть функции <code>greet</code> и <code>main</code>, и их адреса (третья колонка).
Но ещё видна функция <code>printf</code> с адресом <code>000...0</code> в секции <code>*UND*</code>.
Её реализация находится в стандартной библиотеке.</p>
<p>У файлов стандартной библиотеки есть соответствующие таблицы символов (будет функция <code>printf</code> с адресом).
Линкер высчитывает адреса функций и собирает все в один файл (о разнице статической и динамической линковке поговорим тут <code>TODO: вставить ссылку на динамические библиотеки</code>).</p>
<p>Можно запустить линкер и получить на выходе исполняемый файл</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcc main.o
</span></span></code></pre></div><h3 id="чем-ещё-занимается-линкер">
  Чем ещё занимается линкер
  <a class="anchor" href="#%d1%87%d0%b5%d0%bc-%d0%b5%d1%89%d1%91-%d0%b7%d0%b0%d0%bd%d0%b8%d0%bc%d0%b0%d0%b5%d1%82%d1%81%d1%8f-%d0%bb%d0%b8%d0%bd%d0%ba%d0%b5%d1%80">#</a>
</h3>
<blockquote>
<p>А если я ничего не использую из стандартной библиотеки? Я могу просто взять и запустить
объектный файл? Там ведь уже готовые op-коды</p>
</blockquote>
<p>Ну лет +-30 назад (во времена DOS) такой <code>.o</code> файл уже можно было запустить.
Программа под DOS имела полный контроль над всем компьютером.
Сейчас, когда в операционной системе выполняется несколько программ одновременно,
под каждую запускаемую программу (под каждый процесс) необходимо выделить ресурсы -
оперативную память (как минимум).</p>
<p>Линкер прописывает, какие секции (куски памяти) с какими правами и какого размера
нужны программе для работы.
Без этой информации операционная система просто не запустит программу.</p>
<h2 id="а-ещё-я-вам-все-это-время-врал">
  А ещё я вам все это время врал
  <a class="anchor" href="#%d0%b0-%d0%b5%d1%89%d1%91-%d1%8f-%d0%b2%d0%b0%d0%bc-%d0%b2%d1%81%d0%b5-%d1%8d%d1%82%d0%be-%d0%b2%d1%80%d0%b5%d0%bc%d1%8f-%d0%b2%d1%80%d0%b0%d0%bb">#</a>
</h2>
<p>Заметили, что на каждом шаге мы запускали <code>gcc</code>?
Так вот на самом деле это не компилятор.</p>
<ul>
<li><code>gcc</code> - <code>Gnu C Compiler</code> - препроцессор и компилятор</li>
<li><code>as</code> - <code>gnu ASsembler</code> - ассемблер</li>
<li><code>ld</code> - <code>the gnu linker</code> - линкер</li>
</ul>
<p><code>gcc</code> - это <code>Gnu Compiler Collection</code>. Помимо компилятора C там ещё и компилятор
fortran например. Но он же умеет запускать и ассемблер с линкером.</p>
<p>Можете попробовать позапускать линкер самостоятельно, но у него давольно много аргументов.
Получится только что-то страшное типа</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ld /usr/lib/x86_64-linux-gnu/crti.o /usr/lib/x86_64-linux-gnu/crtn.o /usr/lib/x86_64-linux-gnu/crt1.o -lc main.o -dynamic-linker /lib64/ld-linux-x86-64.so.2 -o main_ELF_executable
</span></span></code></pre></div><p>Ну вот зачем вам помнить пути до стандартных библиотек?) Вот <code>gcc</code> и передает их за вас))</p>
<h2 id="elf-файл">
  ELF файл
  <a class="anchor" href="#elf-%d1%84%d0%b0%d0%b9%d0%bb">#</a>
</h2>
<p>Подробно будем разбирать ELF файлы вот тут (<code>TODO: вставить ссылку на дин. библиотеки</code>).
Но там ровно такие же op-коды</p>
<details ><summary>op-коды</summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ objdump -d -M intel a.out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a.out:     file format elf64-x86-64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Disassembly of section .init:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0000000000001000</span> &lt;_init&gt;:
</span></span><span style="display:flex;"><span>    1000:	f3 0f 1e fa          	endbr64
</span></span><span style="display:flex;"><span>    1004:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">08</span>          	sub    rsp,0x8
</span></span><span style="display:flex;"><span>    1008:	<span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">05</span> c1 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	mov    rax,QWORD PTR <span style="color:#f92672">[</span>rip+0x2fc1<span style="color:#f92672">]</span>        <span style="color:#75715e"># 3fd0 &lt;__gmon_start__@Base&gt;</span>
</span></span><span style="display:flex;"><span>    100f:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">85</span> c0             	test   rax,rax
</span></span><span style="display:flex;"><span>    1012:	<span style="color:#ae81ff">74</span> <span style="color:#ae81ff">02</span>                	je     <span style="color:#ae81ff">1016</span> &lt;_init+0x16&gt;
</span></span><span style="display:flex;"><span>    1014:	ff d0                	call   rax
</span></span><span style="display:flex;"><span>    1016:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> c4 <span style="color:#ae81ff">08</span>          	add    rsp,0x8
</span></span><span style="display:flex;"><span>    101a:	c3                   	ret
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Disassembly of section .plt:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0000000000001020</span> &lt;printf@plt-0x10&gt;:
</span></span><span style="display:flex;"><span>    1020:	ff <span style="color:#ae81ff">35</span> ca 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>    	push   QWORD PTR <span style="color:#f92672">[</span>rip+0x2fca<span style="color:#f92672">]</span>        <span style="color:#75715e"># 3ff0 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;</span>
</span></span><span style="display:flex;"><span>    1026:	ff <span style="color:#ae81ff">25</span> cc 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>    	jmp    QWORD PTR <span style="color:#f92672">[</span>rip+0x2fcc<span style="color:#f92672">]</span>        <span style="color:#75715e"># 3ff8 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;</span>
</span></span><span style="display:flex;"><span>    102c:	0f 1f <span style="color:#ae81ff">40</span> <span style="color:#ae81ff">00</span>          	nop    DWORD PTR <span style="color:#f92672">[</span>rax+0x0<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0000000000001030</span> &lt;printf@plt&gt;:
</span></span><span style="display:flex;"><span>    1030:	ff <span style="color:#ae81ff">25</span> ca 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>    	jmp    QWORD PTR <span style="color:#f92672">[</span>rip+0x2fca<span style="color:#f92672">]</span>        <span style="color:#75715e"># 4000 &lt;printf@GLIBC_2.2.5&gt;</span>
</span></span><span style="display:flex;"><span>    1036:	<span style="color:#ae81ff">68</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       	push   0x0
</span></span><span style="display:flex;"><span>    103b:	e9 e0 ff ff ff       	jmp    <span style="color:#ae81ff">1020</span> &lt;_init+0x20&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Disassembly of section .text:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0000000000001040</span> &lt;_start&gt;:
</span></span><span style="display:flex;"><span>    1040:	f3 0f 1e fa          	endbr64
</span></span><span style="display:flex;"><span>    1044:	<span style="color:#ae81ff">31</span> ed                	xor    ebp,ebp
</span></span><span style="display:flex;"><span>    1046:	<span style="color:#ae81ff">49</span> <span style="color:#ae81ff">89</span> d1             	mov    r9,rdx
</span></span><span style="display:flex;"><span>    1049:	5e                   	pop    rsi
</span></span><span style="display:flex;"><span>    104a:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> e2             	mov    rdx,rsp
</span></span><span style="display:flex;"><span>    104d:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> e4 f0          	and    rsp,0xfffffffffffffff0
</span></span><span style="display:flex;"><span>    1051:	<span style="color:#ae81ff">50</span>                   	push   rax
</span></span><span style="display:flex;"><span>    1052:	<span style="color:#ae81ff">54</span>                   	push   rsp
</span></span><span style="display:flex;"><span>    1053:	<span style="color:#ae81ff">45</span> <span style="color:#ae81ff">31</span> c0             	xor    r8d,r8d
</span></span><span style="display:flex;"><span>    1056:	<span style="color:#ae81ff">31</span> c9                	xor    ecx,ecx
</span></span><span style="display:flex;"><span>    1058:	<span style="color:#ae81ff">48</span> 8d 3d <span style="color:#ae81ff">04</span> <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	lea    rdi,<span style="color:#f92672">[</span>rip+0x104<span style="color:#f92672">]</span>        <span style="color:#75715e"># 1163 &lt;main&gt;</span>
</span></span><span style="display:flex;"><span>    105f:	ff <span style="color:#ae81ff">15</span> 5b 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>    	call   QWORD PTR <span style="color:#f92672">[</span>rip+0x2f5b<span style="color:#f92672">]</span>        <span style="color:#75715e"># 3fc0 &lt;__libc_start_main@GLIBC_2.34&gt;</span>
</span></span><span style="display:flex;"><span>    1065:	f4                   	hlt
</span></span><span style="display:flex;"><span>    1066:	<span style="color:#ae81ff">66</span> 2e 0f 1f <span style="color:#ae81ff">84</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	cs nop WORD PTR <span style="color:#f92672">[</span>rax+rax*1+0x0<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    106d:	<span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 
</span></span><span style="display:flex;"><span>    1070:	<span style="color:#ae81ff">48</span> 8d 3d a1 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	lea    rdi,<span style="color:#f92672">[</span>rip+0x2fa1<span style="color:#f92672">]</span>        <span style="color:#75715e"># 4018 &lt;__TMC_END__&gt;</span>
</span></span><span style="display:flex;"><span>    1077:	<span style="color:#ae81ff">48</span> 8d <span style="color:#ae81ff">05</span> 9a 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	lea    rax,<span style="color:#f92672">[</span>rip+0x2f9a<span style="color:#f92672">]</span>        <span style="color:#75715e"># 4018 &lt;__TMC_END__&gt;</span>
</span></span><span style="display:flex;"><span>    107e:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">39</span> f8             	cmp    rax,rdi
</span></span><span style="display:flex;"><span>    1081:	<span style="color:#ae81ff">74</span> <span style="color:#ae81ff">15</span>                	je     <span style="color:#ae81ff">1098</span> &lt;_start+0x58&gt;
</span></span><span style="display:flex;"><span>    1083:	<span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">05</span> 3e 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	mov    rax,QWORD PTR <span style="color:#f92672">[</span>rip+0x2f3e<span style="color:#f92672">]</span>        <span style="color:#75715e"># 3fc8 &lt;_ITM_deregisterTMCloneTable@Base&gt;</span>
</span></span><span style="display:flex;"><span>    108a:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">85</span> c0             	test   rax,rax
</span></span><span style="display:flex;"><span>    108d:	<span style="color:#ae81ff">74</span> <span style="color:#ae81ff">09</span>                	je     <span style="color:#ae81ff">1098</span> &lt;_start+0x58&gt;
</span></span><span style="display:flex;"><span>    108f:	ff e0                	jmp    rax
</span></span><span style="display:flex;"><span>    1091:	0f 1f <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	nop    DWORD PTR <span style="color:#f92672">[</span>rax+0x0<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    1098:	c3                   	ret
</span></span><span style="display:flex;"><span>    1099:	0f 1f <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	nop    DWORD PTR <span style="color:#f92672">[</span>rax+0x0<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    10a0:	<span style="color:#ae81ff">48</span> 8d 3d <span style="color:#ae81ff">71</span> 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	lea    rdi,<span style="color:#f92672">[</span>rip+0x2f71<span style="color:#f92672">]</span>        <span style="color:#75715e"># 4018 &lt;__TMC_END__&gt;</span>
</span></span><span style="display:flex;"><span>    10a7:	<span style="color:#ae81ff">48</span> 8d <span style="color:#ae81ff">35</span> 6a 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	lea    rsi,<span style="color:#f92672">[</span>rip+0x2f6a<span style="color:#f92672">]</span>        <span style="color:#75715e"># 4018 &lt;__TMC_END__&gt;</span>
</span></span><span style="display:flex;"><span>    10ae:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">29</span> fe             	sub    rsi,rdi
</span></span><span style="display:flex;"><span>    10b1:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> f0             	mov    rax,rsi
</span></span><span style="display:flex;"><span>    10b4:	<span style="color:#ae81ff">48</span> c1 ee 3f          	shr    rsi,0x3f
</span></span><span style="display:flex;"><span>    10b8:	<span style="color:#ae81ff">48</span> c1 f8 <span style="color:#ae81ff">03</span>          	sar    rax,0x3
</span></span><span style="display:flex;"><span>    10bc:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">01</span> c6             	add    rsi,rax
</span></span><span style="display:flex;"><span>    10bf:	<span style="color:#ae81ff">48</span> d1 fe             	sar    rsi,1
</span></span><span style="display:flex;"><span>    10c2:	<span style="color:#ae81ff">74</span> <span style="color:#ae81ff">14</span>                	je     10d8 &lt;_start+0x98&gt;
</span></span><span style="display:flex;"><span>    10c4:	<span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">05</span> 0d 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	mov    rax,QWORD PTR <span style="color:#f92672">[</span>rip+0x2f0d<span style="color:#f92672">]</span>        <span style="color:#75715e"># 3fd8 &lt;_ITM_registerTMCloneTable@Base&gt;</span>
</span></span><span style="display:flex;"><span>    10cb:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">85</span> c0             	test   rax,rax
</span></span><span style="display:flex;"><span>    10ce:	<span style="color:#ae81ff">74</span> <span style="color:#ae81ff">08</span>                	je     10d8 &lt;_start+0x98&gt;
</span></span><span style="display:flex;"><span>    10d0:	ff e0                	jmp    rax
</span></span><span style="display:flex;"><span>    10d2:	<span style="color:#ae81ff">66</span> 0f 1f <span style="color:#ae81ff">44</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>    	nop    WORD PTR <span style="color:#f92672">[</span>rax+rax*1+0x0<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    10d8:	c3                   	ret
</span></span><span style="display:flex;"><span>    10d9:	0f 1f <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	nop    DWORD PTR <span style="color:#f92672">[</span>rax+0x0<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    10e0:	f3 0f 1e fa          	endbr64
</span></span><span style="display:flex;"><span>    10e4:	<span style="color:#ae81ff">80</span> 3d 2d 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	cmp    BYTE PTR <span style="color:#f92672">[</span>rip+0x2f2d<span style="color:#f92672">]</span>,0x0        <span style="color:#75715e"># 4018 &lt;__TMC_END__&gt;</span>
</span></span><span style="display:flex;"><span>    10eb:	<span style="color:#ae81ff">75</span> <span style="color:#ae81ff">33</span>                	jne    <span style="color:#ae81ff">1120</span> &lt;_start+0xe0&gt;
</span></span><span style="display:flex;"><span>    10ed:	<span style="color:#ae81ff">55</span>                   	push   rbp
</span></span><span style="display:flex;"><span>    10ee:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> 3d ea 2e <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	cmp    QWORD PTR <span style="color:#f92672">[</span>rip+0x2eea<span style="color:#f92672">]</span>,0x0        <span style="color:#75715e"># 3fe0 &lt;__cxa_finalize@GLIBC_2.2.5&gt;</span>
</span></span><span style="display:flex;"><span>    10f5:	<span style="color:#ae81ff">00</span> 
</span></span><span style="display:flex;"><span>    10f6:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> e5             	mov    rbp,rsp
</span></span><span style="display:flex;"><span>    10f9:	<span style="color:#ae81ff">74</span> 0d                	je     <span style="color:#ae81ff">1108</span> &lt;_start+0xc8&gt;
</span></span><span style="display:flex;"><span>    10fb:	<span style="color:#ae81ff">48</span> 8b 3d 0e 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	mov    rdi,QWORD PTR <span style="color:#f92672">[</span>rip+0x2f0e<span style="color:#f92672">]</span>        <span style="color:#75715e"># 4010 &lt;__dso_handle&gt;</span>
</span></span><span style="display:flex;"><span>    1102:	ff <span style="color:#ae81ff">15</span> d8 2e <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>    	call   QWORD PTR <span style="color:#f92672">[</span>rip+0x2ed8<span style="color:#f92672">]</span>        <span style="color:#75715e"># 3fe0 &lt;__cxa_finalize@GLIBC_2.2.5&gt;</span>
</span></span><span style="display:flex;"><span>    1108:	e8 <span style="color:#ae81ff">63</span> ff ff ff       	call   <span style="color:#ae81ff">1070</span> &lt;_start+0x30&gt;
</span></span><span style="display:flex;"><span>    110d:	c6 <span style="color:#ae81ff">05</span> <span style="color:#ae81ff">04</span> 2f <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">01</span> 	mov    BYTE PTR <span style="color:#f92672">[</span>rip+0x2f04<span style="color:#f92672">]</span>,0x1        <span style="color:#75715e"># 4018 &lt;__TMC_END__&gt;</span>
</span></span><span style="display:flex;"><span>    1114:	5d                   	pop    rbp
</span></span><span style="display:flex;"><span>    1115:	c3                   	ret
</span></span><span style="display:flex;"><span>    1116:	<span style="color:#ae81ff">66</span> 2e 0f 1f <span style="color:#ae81ff">84</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	cs nop WORD PTR <span style="color:#f92672">[</span>rax+rax*1+0x0<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    111d:	<span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 
</span></span><span style="display:flex;"><span>    1120:	c3                   	ret
</span></span><span style="display:flex;"><span>    1121:	<span style="color:#ae81ff">66</span> <span style="color:#ae81ff">66</span> 2e 0f 1f <span style="color:#ae81ff">84</span> <span style="color:#ae81ff">00</span> 	data16 cs nop WORD PTR <span style="color:#f92672">[</span>rax+rax*1+0x0<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    1128:	<span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 
</span></span><span style="display:flex;"><span>    112c:	0f 1f <span style="color:#ae81ff">40</span> <span style="color:#ae81ff">00</span>          	nop    DWORD PTR <span style="color:#f92672">[</span>rax+0x0<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    1130:	f3 0f 1e fa          	endbr64
</span></span><span style="display:flex;"><span>    1134:	e9 <span style="color:#ae81ff">67</span> ff ff ff       	jmp    10a0 &lt;_start+0x60&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0000000000001139</span> &lt;greet&gt;:
</span></span><span style="display:flex;"><span>    1139:	<span style="color:#ae81ff">55</span>                   	push   rbp
</span></span><span style="display:flex;"><span>    113a:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> e5             	mov    rbp,rsp
</span></span><span style="display:flex;"><span>    113d:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">10</span>          	sub    rsp,0x10
</span></span><span style="display:flex;"><span>    1141:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> 7d f8          	mov    QWORD PTR <span style="color:#f92672">[</span>rbp-0x8<span style="color:#f92672">]</span>,rdi
</span></span><span style="display:flex;"><span>    1145:	<span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">45</span> f8          	mov    rax,QWORD PTR <span style="color:#f92672">[</span>rbp-0x8<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    1149:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> c6             	mov    rsi,rax
</span></span><span style="display:flex;"><span>    114c:	<span style="color:#ae81ff">48</span> 8d <span style="color:#ae81ff">05</span> b1 0e <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	lea    rax,<span style="color:#f92672">[</span>rip+0xeb1<span style="color:#f92672">]</span>        <span style="color:#75715e"># 2004 &lt;_IO_stdin_used+0x4&gt;</span>
</span></span><span style="display:flex;"><span>    1153:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> c7             	mov    rdi,rax
</span></span><span style="display:flex;"><span>    1156:	b8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       	mov    eax,0x0
</span></span><span style="display:flex;"><span>    115b:	e8 d0 fe ff ff       	call   <span style="color:#ae81ff">1030</span> &lt;printf@plt&gt;
</span></span><span style="display:flex;"><span>    1160:	<span style="color:#ae81ff">90</span>                   	nop
</span></span><span style="display:flex;"><span>    1161:	c9                   	leave
</span></span><span style="display:flex;"><span>    1162:	c3                   	ret
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0000000000001163</span> &lt;main&gt;:
</span></span><span style="display:flex;"><span>    1163:	<span style="color:#ae81ff">55</span>                   	push   rbp
</span></span><span style="display:flex;"><span>    1164:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> e5             	mov    rbp,rsp
</span></span><span style="display:flex;"><span>    1167:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">10</span>          	sub    rsp,0x10
</span></span><span style="display:flex;"><span>    116b:	<span style="color:#ae81ff">89</span> 7d fc             	mov    DWORD PTR <span style="color:#f92672">[</span>rbp-0x4<span style="color:#f92672">]</span>,edi
</span></span><span style="display:flex;"><span>    116e:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> <span style="color:#ae81ff">75</span> f0          	mov    QWORD PTR <span style="color:#f92672">[</span>rbp-0x10<span style="color:#f92672">]</span>,rsi
</span></span><span style="display:flex;"><span>    1172:	<span style="color:#ae81ff">83</span> 7d fc <span style="color:#ae81ff">02</span>          	cmp    DWORD PTR <span style="color:#f92672">[</span>rbp-0x4<span style="color:#f92672">]</span>,0x2
</span></span><span style="display:flex;"><span>    1176:	<span style="color:#ae81ff">74</span> <span style="color:#ae81ff">25</span>                	je     119d &lt;main+0x3a&gt;
</span></span><span style="display:flex;"><span>    1178:	<span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">45</span> f0          	mov    rax,QWORD PTR <span style="color:#f92672">[</span>rbp-0x10<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    117c:	<span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">00</span>             	mov    rax,QWORD PTR <span style="color:#f92672">[</span>rax<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    117f:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> c6             	mov    rsi,rax
</span></span><span style="display:flex;"><span>    1182:	<span style="color:#ae81ff">48</span> 8d <span style="color:#ae81ff">05</span> <span style="color:#ae81ff">86</span> 0e <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 	lea    rax,<span style="color:#f92672">[</span>rip+0xe86<span style="color:#f92672">]</span>        <span style="color:#75715e"># 200f &lt;_IO_stdin_used+0xf&gt;</span>
</span></span><span style="display:flex;"><span>    1189:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> c7             	mov    rdi,rax
</span></span><span style="display:flex;"><span>    118c:	b8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       	mov    eax,0x0
</span></span><span style="display:flex;"><span>    1191:	e8 9a fe ff ff       	call   <span style="color:#ae81ff">1030</span> &lt;printf@plt&gt;
</span></span><span style="display:flex;"><span>    1196:	b8 <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       	mov    eax,0x1
</span></span><span style="display:flex;"><span>    119b:	eb <span style="color:#ae81ff">18</span>                	jmp    11b5 &lt;main+0x52&gt;
</span></span><span style="display:flex;"><span>    119d:	<span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">45</span> f0          	mov    rax,QWORD PTR <span style="color:#f92672">[</span>rbp-0x10<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    11a1:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> c0 <span style="color:#ae81ff">08</span>          	add    rax,0x8
</span></span><span style="display:flex;"><span>    11a5:	<span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">00</span>             	mov    rax,QWORD PTR <span style="color:#f92672">[</span>rax<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    11a8:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> c7             	mov    rdi,rax
</span></span><span style="display:flex;"><span>    11ab:	e8 <span style="color:#ae81ff">89</span> ff ff ff       	call   <span style="color:#ae81ff">1139</span> &lt;greet&gt;
</span></span><span style="display:flex;"><span>    11b0:	b8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>       	mov    eax,0x0
</span></span><span style="display:flex;"><span>    11b5:	c9                   	leave
</span></span><span style="display:flex;"><span>    11b6:	c3                   	ret
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Disassembly of section .fini:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>00000000000011b8 &lt;_fini&gt;:
</span></span><span style="display:flex;"><span>    11b8:	f3 0f 1e fa          	endbr64
</span></span><span style="display:flex;"><span>    11bc:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">08</span>          	sub    rsp,0x8
</span></span><span style="display:flex;"><span>    11c0:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> c4 <span style="color:#ae81ff">08</span>          	add    rsp,0x8
</span></span><span style="display:flex;"><span>    11c4:	c3                   	ret
</span></span></code></pre></div>  </div>
</details>
<p>Но врал вам не только я))
В <code>a.out</code> файле легко находится функция <code>_start</code></p>
<details ><summary>вот тут _start</summary>
  <div class="markdown-inner">
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="background-color:#3c3d38"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Disassembly of section .text:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#ae81ff">0000000000001040</span> &lt;_start&gt;:
</span></span><span style="display:flex;"><span>    1040:	f3 0f 1e fa          	endbr64
</span></span><span style="display:flex;"><span>    1044:	<span style="color:#ae81ff">31</span> ed                	xor    ebp,ebp
</span></span><span style="display:flex;"><span>    1046:	<span style="color:#ae81ff">49</span> <span style="color:#ae81ff">89</span> d1             	mov    r9,rdx
</span></span><span style="display:flex;"><span>    1049:	5e                   	pop    rsi
</span></span><span style="display:flex;"><span>    104a:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> e2             	mov    rdx,rsp
</span></span><span style="display:flex;"><span>    104d:	<span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> e4 f0          	and    rsp,0xfffffffffffffff0
</span></span><span style="display:flex;"><span>    1051:	<span style="color:#ae81ff">50</span>                   	push   rax
</span></span><span style="display:flex;"><span>    1052:	<span style="color:#ae81ff">54</span>                   	push   rsp
</span></span><span style="display:flex;"><span>    1053:	<span style="color:#ae81ff">45</span> <span style="color:#ae81ff">31</span> c0             	xor    r8d,r8d</span></span></code></pre></td></tr></table>
</div>
</div>
  </div>
</details>
<p>С функции <code>_start</code> начинается выполнение программ в Unix-системах.
Функция <code>main</code> вызывается стандартной библиотекой, где и объявлена
функция <code>_start</code>.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#вот-они-слева-направо">Вот они слева направо</a></li>
    <li><a href="#препроцессор">Препроцессор</a>
      <ul>
        <li><a href="#что-с-его-помощью-можно-делать">Что с его помощью можно делать</a></li>
        <li><a href="#мотивация">Мотивация</a></li>
      </ul>
    </li>
    <li><a href="#компилятор">Компилятор</a></li>
    <li><a href="#ассемблер">Ассемблер</a></li>
    <li><a href="#линкер">Линкер</a>
      <ul>
        <li><a href="#чем-ещё-занимается-линкер">Чем ещё занимается линкер</a></li>
      </ul>
    </li>
    <li><a href="#а-ещё-я-вам-все-это-время-врал">А ещё я вам все это время врал</a></li>
    <li><a href="#elf-файл">ELF файл</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












