<!DOCTYPE html>
<html lang="ru-ru" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Некрономикон
  #

Тут содержится список заклинаний, запрещенных к использованию.
чё?...
  
Содержание любого &ldquo;примера&rdquo; с этой страницы в вашем коде может являеться причиной непрохождения код-ревью
  


  общие требования к любому коду
  #


старайтесь писать красиво

почти всегда красиво = кратко
а ещё почти всегда кратко = читаемо


давайте осмысленные имена переменным и функциям

желательно без однобуквенных названий (не экономьте буквы! они бесплатны)
имена функций - желательно глагол
имена переменных - желательно существительное

для флагов можно is_active (ну типа)


общепринятые имена (src / dst / fd / socket / i / &hellip;) - это круто!


избегайте magic_numbers

those who do not believe in %magic will never find it, но у нас тут C

шутка подготовлена любителями python




&hellip;

(список будет пополняться)">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://daniladanila.github.io/2024-caos-examples/docs/theory/necronomicon/">
  <meta property="og:site_name" content="caos theory">
  <meta property="og:title" content="Некрономикон">
  <meta property="og:description" content=" Некрономикон # Тут содержится список заклинаний, запрещенных к использованию.
чё?... Содержание любого “примера” с этой страницы в вашем коде может являеться причиной непрохождения код-ревью
общие требования к любому коду # старайтесь писать красиво почти всегда красиво = кратко а ещё почти всегда кратко = читаемо давайте осмысленные имена переменным и функциям желательно без однобуквенных названий (не экономьте буквы! они бесплатны) имена функций - желательно глагол имена переменных - желательно существительное для флагов можно is_active (ну типа) общепринятые имена (src / dst / fd / socket / i / …) - это круто! избегайте magic_numbers those who do not believe in %magic will never find it, но у нас тут C шутка подготовлена любителями python … (список будет пополняться)">
  <meta property="og:locale" content="ru_ru">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
<title>Некрономикон | caos theory</title>
<link rel="icon" href="/2024-caos-examples/favicon.png" >
<link rel="manifest" href="/2024-caos-examples/manifest.json">
<link rel="canonical" href="https://daniladanila.github.io/2024-caos-examples/docs/theory/necronomicon/">
<link rel="stylesheet" href="/2024-caos-examples/book.min.3b63b9ecb24b01f1be0df5c6f361b3a2004ab96665227385e0196f67e7607b29.css" integrity="sha256-O2O57LJLAfG&#43;DfXG82GzogBKuWZlInOF4BlvZ&#43;dgeyk=" crossorigin="anonymous">
  <script defer src="/2024-caos-examples/fuse.min.js"></script>
  <script defer src="/2024-caos-examples/en.search.min.76946a08e2ff5ba1ae563c0a283125850bc3c67dc1b255948ac990283f16f842.js" integrity="sha256-dpRqCOL/W6GuVjwKKDElhQvDxn3BslWUismQKD8W&#43;EI=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/2024-caos-examples/"><span>caos theory</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <a href="/2024-caos-examples/docs/theory/" class="">Как закрыть курс</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/2024-caos-examples/docs/theory/whoami/" class="">whoami</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/2024-caos-examples/docs/theory/necronomicon/" class="active">Некрономикон</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-96321df072730b9a64870c0191c9133b" class="toggle"  />
    <label for="section-96321df072730b9a64870c0191c9133b" class="flex justify-between">
      <a href="/2024-caos-examples/docs/theory/devools/" class="">Инструменты разработки</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/2024-caos-examples/docs/theory/devools/bash/" class="">bash</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/2024-caos-examples/docs/theory/devools/build/" class="">этапы сборки</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/2024-caos-examples/docs/theory/devools/debugger/" class="">как ловить ошибки</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/2024-caos-examples/docs/theory/devools/make/" class="">автоматизация сборки</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-123d53d4dd188d20ee5174bebd51adc4" class="toggle"  />
    <label for="section-123d53d4dd188d20ee5174bebd51adc4" class="flex justify-between">
      <a href="/2024-caos-examples/docs/theory/x86_64/" class="">x86_64 assembler</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/2024-caos-examples/docs/theory/x86_64/floats/" class="">floats</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2ac106c088cac53c4787d657cccdb647" class="toggle"  />
    <label for="section-2ac106c088cac53c4787d657cccdb647" class="flex justify-between">
      <a href="/2024-caos-examples/docs/theory/arm/" class="">ARM assembler</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/2024-caos-examples/docs/theory/arm/linaro/" class="">Linaro (а как тестить)</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/2024-caos-examples/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Некрономикон</strong>

  <label for="toc-control">
    
    <img src="/2024-caos-examples/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#общие-требования-к-любому-коду">общие требования к любому коду</a></li>
    <li><a href="#define-ы">define-ы</a>
      <ul>
        <li><a href="#константы">константы</a></li>
        <li><a href="#макросы">макросы</a></li>
      </ul>
    </li>
    <li><a href="#не-дублируйте-библиотечные-константы">не дублируйте библиотечные константы</a></li>
    <li><a href="#работа-с-файлами">работа с файлами</a></li>
    <li><a href="#помните-про-код-возврата">помните про код возврата</a></li>
    <li><a href="#чистите-память-закрывайте-файлы-и-тд">чистите память, закрывайте файлы и т.д.</a></li>
    <li><a href="#корректно-завершайте-работу">корректно завершайте работу</a></li>
    <li><a href="#ассемблер">ассемблер</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="некрономикон">
  Некрономикон
  <a class="anchor" href="#%d0%bd%d0%b5%d0%ba%d1%80%d0%be%d0%bd%d0%be%d0%bc%d0%b8%d0%ba%d0%be%d0%bd">#</a>
</h1>
<p>Тут содержится список заклинаний, запрещенных к использованию.</p>
<details ><summary>чё?...</summary>
  <div class="markdown-inner">
<p>Содержание любого &ldquo;примера&rdquo; с этой страницы в вашем коде <em>может</em> являеться причиной непрохождения код-ревью</p>
  </div>
</details>
<h2 id="общие-требования-к-любому-коду">
  общие требования к любому коду
  <a class="anchor" href="#%d0%be%d0%b1%d1%89%d0%b8%d0%b5-%d1%82%d1%80%d0%b5%d0%b1%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d1%8f-%d0%ba-%d0%bb%d1%8e%d0%b1%d0%be%d0%bc%d1%83-%d0%ba%d0%be%d0%b4%d1%83">#</a>
</h2>
<ul>
<li>старайтесь писать красиво
<ul>
<li>почти всегда <code>красиво = кратко</code></li>
<li>а ещё почти всегда <code>кратко = читаемо</code></li>
</ul>
</li>
<li>давайте осмысленные имена переменным и функциям
<ul>
<li>желательно без однобуквенных названий (не экономьте буквы! они бесплатны)</li>
<li>имена функций - желательно глагол</li>
<li>имена переменных - желательно существительное
<ul>
<li>для флагов можно <code>is_active</code> (ну типа)</li>
</ul>
</li>
<li>общепринятые имена (src / dst / fd / socket / i / &hellip;) - это круто!</li>
</ul>
</li>
<li>избегайте magic_numbers
<ul>
<li><code>those who do not believe in %magic will never find it</code>, но у нас тут C
<ul>
<li>шутка подготовлена любителями python</li>
</ul>
</li>
</ul>
</li>
<li>&hellip;</li>
</ul>
<p>(список будет пополняться)</p>
<h2 id="define-ы">
  define-ы
  <a class="anchor" href="#define-%d1%8b">#</a>
</h2>
<p>Просто нет</p>
<h3 id="константы">
  константы
  <a class="anchor" href="#%d0%ba%d0%be%d0%bd%d1%81%d1%82%d0%b0%d0%bd%d1%82%d1%8b">#</a>
</h3>
<p>Да, иногда хочется вынести константу и написать что-то типо такого</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#define PI 3.1415926
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">double</span> V <span style="color:#f92672">=</span> <span style="color:#ae81ff">4.0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">3.0</span> <span style="color:#f92672">*</span> PI <span style="color:#f92672">*</span> R <span style="color:#f92672">*</span> R <span style="color:#f92672">*</span> R;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>Но в C существуют константы!) Они и в ошибках компиляции будут выглядеть нормально)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">double</span> PI <span style="color:#f92672">=</span> <span style="color:#ae81ff">3.1419526</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">double</span> V <span style="color:#f92672">=</span> <span style="color:#ae81ff">4.0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">3.0</span> <span style="color:#f92672">*</span> PI <span style="color:#f92672">*</span> R <span style="color:#f92672">*</span> R <span style="color:#f92672">*</span> R;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>Для интов есть enum-ы - используйте их</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">enum</span> {
</span></span><span style="display:flex;"><span>    FLAG_1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    FLAG_2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    FLAG_3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>    FLAG_4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    BUFFER_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span>,
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> flags <span style="color:#f92672">=</span> FLAG_1 <span style="color:#f92672">|</span> FLAG_2;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> buffer[BUFFER_SIZE];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="макросы">
  макросы
  <a class="anchor" href="#%d0%bc%d0%b0%d0%ba%d1%80%d0%be%d1%81%d1%8b">#</a>
</h3>
<p>У макросов есть неприятный сайд-эфеект - это подстановка текста.
Конкретно тут <code>++x</code> будет выполнен дважды.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define MAX(a, b) (((a) &gt;= (b)) ? (a) : (b))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> y <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> max_value <span style="color:#f92672">=</span> <span style="color:#a6e22e">MAX</span>(<span style="color:#f92672">++</span>x, y);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;x = %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;y = %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;max_value = %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>        x, y, max_value
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><details ><summary>какой будет вывод?</summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ gcc main.c
</span></span><span style="display:flex;"><span>$ ./a.aout
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>max_value <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>
</span></span></code></pre></div>  </div>
</details>
<p>Это неявное поведение - старайтесь избегать неявного</p>
<h2 id="не-дублируйте-библиотечные-константы">
  не дублируйте библиотечные константы
  <a class="anchor" href="#%d0%bd%d0%b5-%d0%b4%d1%83%d0%b1%d0%bb%d0%b8%d1%80%d1%83%d0%b9%d1%82%d0%b5-%d0%b1%d0%b8%d0%b1%d0%bb%d0%b8%d0%be%d1%82%d0%b5%d1%87%d0%bd%d1%8b%d0%b5-%d0%ba%d0%be%d0%bd%d1%81%d1%82%d0%b0%d0%bd%d1%82%d1%8b">#</a>
</h2>
<p>Если вам нужна константа - погуглите!) Возможно она уже определена.
Правильнее будет её переиспользовать, т.к.</p>
<ul>
<li>константа с таким именем определена не только у вас))</li>
<li>некоторые константы (например PATH_MAX) могут отличаться от системы к системе</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;linux/limits.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>PATH_MAX <span style="color:#75715e">// chars in a path name INCLUDING NULL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>STDIN_FILENO
</span></span><span style="display:flex;"><span>STDOUT_FOLENO
</span></span><span style="display:flex;"><span>STDERR_FILENO
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ... //
</span></span></span></code></pre></div><h2 id="работа-с-файлами">
  работа с файлами
  <a class="anchor" href="#%d1%80%d0%b0%d0%b1%d0%be%d1%82%d0%b0-%d1%81-%d1%84%d0%b0%d0%b9%d0%bb%d0%b0%d0%bc%d0%b8">#</a>
</h2>
<p>Курс посвящен работе с ядром, так что используйте интерфейс ядра.</p>
<p>Работа с файлами <a href="https://datatracker.ietf.org/doc/html/rfc2119">должна</a> происходить через файловые дескрипторы. Код, содержащий <code>FILE*</code> код-ревью не пройдет.</p>
<h2 id="помните-про-код-возврата">
  помните про код возврата
  <a class="anchor" href="#%d0%bf%d0%be%d0%bc%d0%bd%d0%b8%d1%82%d0%b5-%d0%bf%d1%80%d0%be-%d0%ba%d0%be%d0%b4-%d0%b2%d0%be%d0%b7%d0%b2%d1%80%d0%b0%d1%82%d0%b0">#</a>
</h2>
<p>Код возврата в случае успеха - <code>0</code></p>
<p>Если программа завершилась с ошибкой - завершайтесь с кодом <code>!=0</code>.
Желательно ещё и с разными для разных ошибок</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">2</span>;  <span style="color:#75715e">// код возврата != 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... //
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (smth_else_failed) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">3</span>;  <span style="color:#75715e">// другой код возврата != 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... //
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h2 id="чистите-память-закрывайте-файлы-и-тд">
  чистите память, закрывайте файлы и т.д.
  <a class="anchor" href="#%d1%87%d0%b8%d1%81%d1%82%d0%b8%d1%82%d0%b5-%d0%bf%d0%b0%d0%bc%d1%8f%d1%82%d1%8c-%d0%b7%d0%b0%d0%ba%d1%80%d1%8b%d0%b2%d0%b0%d0%b9%d1%82%d0%b5-%d1%84%d0%b0%d0%b9%d0%bb%d1%8b-%d0%b8-%d1%82%d0%b4">#</a>
</h2>
<blockquote>
<p>Оно все равно почистит память после выхода - зачем мне это делать???</p>
</blockquote>
<p>Мы не можем дать вам коммитить в большой продакшн-проект на C - у нас нет такого проекта 😅</p>
<p>Но мы хотим как-то привить вам хорошие привычки. Считайте, что кто-то внешний и большой (кто желательно не должен падать) вызывает ваш модуль - подчищайте за собой.</p>
<h2 id="корректно-завершайте-работу">
  корректно завершайте работу
  <a class="anchor" href="#%d0%ba%d0%be%d1%80%d1%80%d0%b5%d0%ba%d1%82%d0%bd%d0%be-%d0%b7%d0%b0%d0%b2%d0%b5%d1%80%d1%88%d0%b0%d0%b9%d1%82%d0%b5-%d1%80%d0%b0%d0%b1%d0%be%d1%82%d1%83">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... //
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>buffer <span style="color:#f92672">=</span> <span style="color:#a6e22e">malloc</span>(BUFFER_SIZE <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">char</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... //
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (smth_very_wrong) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// всё очень и очень плохо
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// надо прям завершать работу - всё ужасно!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// НАДО ПРИБИТЬ ВЕСЬ ПРОЦЕСС!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">exit</span>(<span style="color:#ae81ff">1</span>);  <span style="color:#75715e">// завершаем работу с кодом возврата != 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... //
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (should_exit_earlier) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// не ошибка
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// но дальше работать смысла не имеет
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">goto</span> free_buffer_and_exit;  <span style="color:#75715e">// и да, это - goto
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... //
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>another_buffer <span style="color:#f92672">=</span> <span style="color:#a6e22e">malloc</span>(BUFFER_SIZE <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">char</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... //
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">free</span>(another_buffer);
</span></span><span style="display:flex;"><span>    free_buffer_and_exit:
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">free</span>(buffer);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>В C <code>goto</code> активно применяется для &ldquo;alarm exit&rdquo;.</p>
<details ><summary>а почему не &lt;название-любого-другого-приема&gt;?</summary>
  <div class="markdown-inner">
<p>Почему так, а не иначе</p>
<ol>
<li>Так исторически сложилось (потому что - см пункт 2)</li>
<li>Попробуйте в C достичь такого же эффекта, но чтоб код при этом
<ul>
<li>остался читаемым</li>
<li>не дублировал сам себя</li>
</ul>
</li>
</ol>
<p>Напрашивается вопрос про C++ - в плюсах для этого существует RAII</p>
  </div>
</details>
<p>Фразу <strong>не используйте goto</strong> вы (наверное) слышали и слышали много от кого. Сейчас, в 21-ом веке лучший аргумент, который вы можете услышать от таких людей, - <em>ДАЖЕ ДЕЙКСТРА ПИСАЛ ОБ ЭТОМ!</em> (это правда - вот статья - <a href="https://homepages.cwi.nl/~storm/teaching/reader/Dijkstra68.pdf">Go To Statement Considered Harmful</a>)</p>
<p>До появления циклов и функций в языках, конструкции вида <code>if (...) goto label;</code> были распространены - и это правда было нечитаемое месиво.
Он не первый, кто об этом высказывался. Но никто не пытался <strong>запретить</strong> <code>goto</code>.
Посыл был - избежать большого кол-ва меток в программах и тем самым сделать код читаемее.</p>
<blockquote>
<p>The remark about the undesirability of the <strong>go to</strong> statement is far from new (68-ой год статьи кста).
I remember having read the explicit recommendation to restrict the use of <strong>go to</strong> statement to
alarm exits, but I have not been able to trace it; presumably, it has been made by C. A. R. Hoare. In [1, Sec. 3.2.1.]
Wirth and Hoare together make a remark in the same direction in motivationg the case construction:
(тут имеются в виду управляющие конструкции - циклы / функции / &hellip;)
&ldquo;Like the conditional, it mirrors the dynamic structure of a program more clearly than <strong>go to</strong>
statements and switches, and it eliminates the need for introducing a large number of labels in the
program.&rdquo;</p>
</blockquote>
<p>Короче можете отвечать, что вам лично Дейкстра разрешил использовать <code>goto</code> для обработки &ldquo;alarm exits&rdquo;</p>
<p>Также, можете использовать <code>goto</code> для выхода из вложенных циклов, если их нельзя красиво вынести в отдельную функию.
Эта практика менее распространена, чем &ldquo;alarm exits&rdquo;, но мало языков позволяют красиво сделать &ldquo;break from inner loop&rdquo; (кроме rust, других не помню)</p>
<h2 id="ассемблер">
  ассемблер
  <a class="anchor" href="#%d0%b0%d1%81%d1%81%d0%b5%d0%bc%d0%b1%d0%bb%d0%b5%d1%80">#</a>
</h2>
<p>magic_numbers можно избегать используя <code>.set</code> (в x86_64)</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#общие-требования-к-любому-коду">общие требования к любому коду</a></li>
    <li><a href="#define-ы">define-ы</a>
      <ul>
        <li><a href="#константы">константы</a></li>
        <li><a href="#макросы">макросы</a></li>
      </ul>
    </li>
    <li><a href="#не-дублируйте-библиотечные-константы">не дублируйте библиотечные константы</a></li>
    <li><a href="#работа-с-файлами">работа с файлами</a></li>
    <li><a href="#помните-про-код-возврата">помните про код возврата</a></li>
    <li><a href="#чистите-память-закрывайте-файлы-и-тд">чистите память, закрывайте файлы и т.д.</a></li>
    <li><a href="#корректно-завершайте-работу">корректно завершайте работу</a></li>
    <li><a href="#ассемблер">ассемблер</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












